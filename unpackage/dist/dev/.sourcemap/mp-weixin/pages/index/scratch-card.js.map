{"version":3,"sources":["webpack:///D:/projects/m-box/pages/index/scratch-card.vue?8d40","webpack:///D:/projects/m-box/pages/index/scratch-card.vue?da8d","webpack:///D:/projects/m-box/pages/index/scratch-card.vue?73b8","webpack:///D:/projects/m-box/pages/index/scratch-card.vue?aa91","uni-app:///pages/index/scratch-card.vue"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAyH;AACzH;AACgE;AACL;;;AAG3D;AACmK;AACnK,gBAAgB,6KAAU;AAC1B,EAAE,kFAAM;AACR,EAAE,uFAAM;AACR,EAAE,gGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,2FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAymB,CAAgB,snBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC6B7nB,e;AACA;AACA,sBADA;AAEA;AACA;AACA,kBADA;AAEA,iBAFA,EADA;;AAKA;AACA,kBADA;AAEA,iBAFA,EALA;;AASA;AACA,kBADA;AAEA,qBAFA,EATA;;AAaA;AACA,kBADA;AAEA,oBAFA,EAbA;;AAiBA;AACA,kBADA;AAEA,wBAFA,EAjBA;;AAqBA;AACA,kBADA;AAEA,iBAFA,EArBA;;AAyBA;AACA,kBADA;AAEA,sBAFA,EAzBA;;AA6BA;AACA,kBADA;AAEA,qBAFA,EA7BA;;AAiCA;AACA,kBADA;AAEA,iBAFA,EAjCA;;AAqCA;AACA,mBADA;AAEA,oBAFA,EArCA,EAFA;;;AA4CA,MA5CA,kBA4CA;AACA;AACA,cADA;AAEA,eAFA;AAGA,kBAHA;AAIA,kBAJA;AAKA,sBALA;AAMA,qBANA;AAOA,kBAPA;AAQA,kBARA;AASA,qBATA;AAUA,2BAVA;;AAYA,GAzDA;AA0DA,SA1DA,qBA0DA;AACA;AACA;AACA,GA7DA;AA8DA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA,EAEA,GAFA;AAGA,OANA,EAMA,IANA;AAOA,KAXA;;AAaA;AACA;AACA;AACA;AACA;AACA,4CALA;AAMA;AACA,mFADA,CANA,SAMA,SANA;;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BArBA,yIAbA;;;AAqCA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA9DA;;AAgEA;AACA,gBAjEA,wBAiEA,KAjEA,EAiEA;AACA;AACA;AACA,oBADA;AAEA;AACA;AACA,WAJA;;AAMA,OAPA;AAQA,KA1EA;AA2EA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAxFA;;AA0FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KArGA;;AAuGA;AACA;AACA,KAzGA;;AA2GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAzHA;;AA2HA;AACA;AACA;AACA;AACA;AACA;AACA,gCADA;AAEA,YAFA;AAGA,YAHA;AAIA,yBAJA;AAKA,2BALA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SArBA;AAsBA;AACA;AACA,SAxBA;AAyBA,UAzBA;AA0BA,KA1JA;;AA4JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAvKA,EA9DA,E","file":"pages/index/scratch-card.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./scratch-card.vue?vue&type=template&id=50d9c74e&\"\nvar renderjs\nimport script from \"./scratch-card.vue?vue&type=script&lang=js&\"\nexport * from \"./scratch-card.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/index/scratch-card.vue\"\nexport default component.exports","export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./scratch-card.vue?vue&type=template&id=50d9c74e&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./scratch-card.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./scratch-card.vue?vue&type=script&lang=js&\"","## 属性说明\r\n\r\n|属性\t|类型\t|说明\t|\r\n|--\t|--\t|--\t|\r\n|percentage\t|Number\t|刮开百分之多少的时候开奖\t，默认45|\r\n|touchSize\t|Number\t|刮痕的宽度，默认20\t|\r\n|fillColor\t|String\t|未刮开图层时的填充色\t|\r\n|watermark\t|String\t|水印文字，默认“刮一刮”\t|\r\n|watermarkColor\t|String\t|水印文字颜色\t|\r\n|watermarkSize\t|Number\t|水印文字大小，默认14\t|\r\n|title\t|String\t|标题，默认：刮一刮开奖\t|\r\n|titleColor\t|String\t|标题颜色\t|\r\n|titleSize\t|Number\t|标题文字大小，默认24\t|\r\n|disabled\t|boolean\t|是否禁止刮卡\t|\r\n|@complete\t|function\t|刮卡完成回调事件\t|\r\n|v-slot\t|默认插槽\t|刮卡显示的内容，本内容将被刮刮卡覆盖遮挡，刮刮后显示\t|\r\n|init()\t|重置方法\t|通过调用该方法，重置到初始状态\t|\r\n<template>\n\t<view class=\"base-cloud\">\r\n\t\t<view class=\"father\" id=\"canvas\" style=\"position: relative;\">\r\n\t\t\t<view :class=\"{op0 : !ready }\">\r\n\t\t\t\t<slot></slot>\r\n\t\t\t</view>\r\n\t\t\t<canvas :style=\"{width: width+'px', height : height+'px',position:'absolute',top:0}\" class=\"abs\" :disable-scroll=\"true\" @touchstart=\"touchstart\" @touchend=\"touchend\" @touchmove=\"touchmove\" canvas-id=\"scratch-card\"></canvas>\r\n\t\t</view>\n\t</view>\n</template>\n\n<script>\r\n\tlet ctx = null ;\n\texport default {\r\n\t\tname : \"scratch-card\" ,\r\n\t\tprops:{\r\n\t\t\tpercentage : { //刮开百分之多少的时候开奖\r\n\t\t\t\ttype : Number ,\r\n\t\t\t\tdefault : 45 \r\n\t\t\t},\r\n\t\t\ttouchSize : { //触摸画笔大小\r\n\t\t\t\ttype : Number ,\r\n\t\t\t\tdefault : 20 \r\n\t\t\t},\r\n\t\t\tfillColor : { //未刮开图层时的填充色\r\n\t\t\t\ttype : String ,\r\n\t\t\t\tdefault : '#ddd' \r\n\t\t\t},\r\n\t\t\twatermark : { //水印文字\r\n\t\t\t\ttype : String ,\r\n\t\t\t\tdefault : '刮一刮' \r\n\t\t\t},\r\n\t\t\twatermarkColor : { //水印文字颜色\r\n\t\t\t\ttype : String ,\r\n\t\t\t\tdefault : '#c5c5c5' \r\n\t\t\t},\r\n\t\t\twatermarkSize : { //水印文字大小\r\n\t\t\t\ttype : Number ,\r\n\t\t\t\tdefault : 14 \r\n\t\t\t},\r\n\t\t\ttitle : { //提示文字\r\n\t\t\t\ttype : String ,\r\n\t\t\t\tdefault : '刮一刮开奖' \r\n\t\t\t},\r\n\t\t\ttitleColor : { //提示文字颜色\r\n\t\t\t\ttype : String ,\r\n\t\t\t\tdefault : '#888' \r\n\t\t\t},\r\n\t\t\ttitleSize : { //提示文字大小\r\n\t\t\t\ttype : Number ,\r\n\t\t\t\tdefault : 24 \r\n\t\t\t},\r\n\t\t\tdisabled : { //是否禁止刮卡\r\n\t\t\t\ttype : Boolean ,\r\n\t\t\t\tdefault : false \r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\n\t\t\treturn {\r\n\t\t\t\twidth : 0 ,\r\n\t\t\t\theight : 0 ,\n\t\t\t\tstartX : null ,\r\n\t\t\t\tstartY : null ,\r\n\t\t\t\tcomputing : false ,\r\n\t\t\t\tcomplete : false ,\r\n\t\t\t\treset : false ,\r\n\t\t\t\tready : false ,\r\n\t\t\t\tstorePoints:[],\r\n\t\t\t\tstartTouchOnce:false\n\t\t\t};\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tctx = uni.createCanvasContext(\"scratch-card\" , this) ;\r\n\t\t\tthis.getRect();\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\t\r\n\t\t\tgetRect:function(e){\r\n\t\t\t\tconst query = uni.createSelectorQuery().in(this);\r\n\t\t\t\tquery.select('#canvas').boundingClientRect(data => {\r\n\t\t\t\t\tthis.width = data.width;\r\n\t\t\t\t\tthis.height = data.height;\r\n\t\t\t\t\tsetTimeout(e => {\r\n\t\t\t\t\t\tthis.init();\r\n\t\t\t\t\t},100);\r\n\t\t\t\t}).exec();\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tinit : async function(e){\r\n\t\t\t\tthis.computing = false ;\r\n\t\t\t\tthis.complete = false ;\r\n\t\t\t\tthis.reset = false ;\r\n\t\t\t\tthis.ready = false ;\r\n\t\t\t\tthis.startTouchOnce=false\r\n\t\t\t\tlet bgImgPath = await this.getImageInfo(\r\n\t\t\t\t\t'https://img-cdn.macaotown.com/o_1f2lu953l1fkf1rsf27ihd5vm0s.png'\r\n\t\t\t\t)\r\n\t\t\t\tctx.clearRect(0,0,this.width,this.height);\r\n\t\t\t\t//绘制画布\r\n\t\t\t\tctx.setFillStyle(this.fillColor);\r\n\t\t\t\tctx.fillRect(0, 0, this.width , this.height );\r\n\t\t\t\tthis.ready = true ;\r\n\t\t\t\t//绘制文字水印\r\n\t\t\t\tthis.fillWatermark();\r\n\t\t\t\t// 繪製背景圖\r\n\t\t\t\tctx.drawImage(bgImgPath.path, 0, 0, this.width, this.height)\r\n\t\t\t\tctx.save()\r\n\t\t\t\t//绘制标题\r\n\t\t\t\tthis.fillTitle();\r\n\t\t\t\tctx.draw();\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * 绘制文字水印\r\n\t\t\t */\r\n\t\t\tfillWatermark : function(e){\r\n\t\t\t\tif (!this.watermark) {\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tvar width = this.watermark.length * this.watermarkSize ;\r\n\t\t\t\tctx.save() ;\r\n\t\t\t\tctx.rotate(-10 * Math.PI / 180);\r\n\t\t\t\tlet x = 0 ; \r\n\t\t\t\tlet y = 0 ;\r\n\t\t\t\tlet i = 0 ;\r\n\t\t\t\twhile( (x <= this.width * 5 || y <= this.height*5) && i < 300){\r\n\t\t\t\t\tctx.setFillStyle(this.watermarkColor);\r\n\t\t\t\t\tctx.setFontSize(this.watermarkSize);\r\n\t\t\t\t\tctx.fillText(this.watermark,  x  , y );\r\n\t\t\t\t\tx += width + width * 1.6 ;\r\n\t\t\t\t\tif (x > this.width && y <= this.height ) {\r\n\t\t\t\t\t\tx = -Math.random()*100 ;\r\n\t\t\t\t\t\ty += this.watermarkSize * 3 ;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ti++ ;\r\n\t\t\t\t}\r\n\t\t\t\tctx.restore();\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 获取图片信息\r\n\t\t\tgetImageInfo(image) {\r\n\t\t\t\treturn new Promise((req, rej) => {\r\n\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\tsrc: image,\r\n\t\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\t\treq(res)\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 绘制标题\r\n\t\t\t */\r\n\t\t\tfillTitle : function(e){\r\n\t\t\t\tif (!this.title) {\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tctx.setTextAlign(\"center\");\r\n\t\t\t\tctx.setTextBaseline(\"middle\");\r\n\t\t\t\tctx.setFillStyle(this.titleColor);\r\n\t\t\t\tctx.setFontSize(this.titleSize);\r\n\t\t\t\tctx.font = 'bold italic '+this.titleSize+'px sans-serif '\r\n\t\t\t\tctx.fillText(this.title,  this.width/2  , this.height/3 );\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\ttouchstart : function(e){\r\n\t\t\t\tif (this.disabled) {\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tthis.startX = e.touches[0].x;\r\n\t\t\t\tthis.startY = e.touches[0].y;\r\n\t\t\t\t// 用戶開始掛卡\r\n\t\t\t\tif(this.startTouchOnce==false){\r\n\t\t\t\t\tthis.$emit('startTouch',true)\r\n\t\t\t\t\tthis.startTouchOnce=true\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\ttouchend : function(e){\r\n\t\t\t\tthis.getFilledPercentage();\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\ttouchmove : function(e){\r\n\t\t\t\tif(this.complete || this.disabled ){\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\t// ctx.globalCompositeOperation = 'destination-out'; \r\n\t\t\t\tctx.moveTo(this.startX , this.startY );\r\n\t\t\t\t// ctx.beginPath();\r\n\t\t\t\t// ctx.arc(this.startX, this.startY, 20, 0, Math.PI * 20);\r\n\t\t\t\t// ctx.fill();\r\n\t\t\t\tctx.clearRect( this.startX , this.startY , this.touchSize , this.touchSize ) ;\r\n\t\t\t\tctx.draw(true);\r\n\t\t\t\t//记录移动点位\r\n\t\t\t\tthis.startX = e.touches[0].x;\r\n\t\t\t\tthis.startY = e.touches[0].y;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tgetFilledPercentage:function(e){\r\n\t\t\t\tif (this.computing) {\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tthis.computing = true ;\r\n\t\t\t\tuni.canvasGetImageData({\r\n\t\t\t\t\tcanvasId: 'scratch-card' ,\r\n\t\t\t\t\tx: 0,\r\n\t\t\t\t\ty: 0,\r\n\t\t\t\t\twidth: this.width ,\r\n\t\t\t\t\theight: this.height ,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tlet pixels = res.data;\r\n\t\t\t\t\t\tlet transPixels = [];\r\n\t\t\t\t\t\tfor (let i = 0; i < pixels.length; i += 4) {\r\n\t\t\t\t\t\t\tif (pixels[i + 3] < 128) {\r\n\t\t\t\t\t\t\t\ttransPixels.push(pixels[i + 3]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar percent = (transPixels.length / (pixels.length / 4) * 100).toFixed(2);\r\n\t\t\t\t\t\tif( percent >= this.percentage ){\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis.success();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.computing = false ;\r\n\t\t\t\t\t\tconsole.log(percent)\r\n\t\t\t\t\t\tthis.$emit('stopMove',percent)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail : function(e){\r\n\t\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\t},\r\n\t\t\t\t}, this);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tsuccess : function(e){\r\n\t\t\t\tthis.complete = true ;\r\n\t\t\t\tif (this.reset) {\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tthis.reset = true ;\r\n\t\t\t\tctx.moveTo(0, 0);\r\n\t\t\t\tctx.clearRect(0,0, this.width, this.height);\r\n\t\t\t\tctx.stroke() ;\r\n\t\t\t\tctx.draw(true);\r\n\t\t\t\tthis.$emit(\"complete\",{});\r\n\t\t\t},\r\n\t\t}\n\t}\n</script>\n\n<style>\n\n</style>\n"],"sourceRoot":""}